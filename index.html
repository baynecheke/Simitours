<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Simitaur Adventure — Complete</title>
<style>
  :root{
    --bg:#0e1610; --panel:rgba(6,8,6,.88);
    --card:#16261a; --accent:#ffd166; --btn:#2f6e3a; --btn-h:#3f8e4d;
    --danger:#ff5b5b; --ink:#d8ffe5;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#fff}
  .wrap{max-width:1100px;margin:10px auto;padding:8px}
  canvas#game{
    display:block;margin:10px auto;border:3px solid #274f34;background:#87d594;
    image-rendering:pixelated;image-rendering:crisp-edges;touch-action:none
  }
  /* HUD */
  #hud{position:fixed;top:10px;right:10px;left:auto;display:flex;gap:8px;z-index:60;flex-wrap:wrap}
  .pill{background:var(--btn);border:none;color:#fff;border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer;box-shadow:0 3px 0 #204c28}
  .pill:active{transform:translateY(1px)}
  .pill.secondary{background:#24422b}
  /* DPad */
  #dpad{
    position:fixed;left:12px;bottom:12px;display:grid;
    grid-template-columns:56px 56px;grid-template-rows:56px 56px 56px;gap:8px;z-index:60
  }
  #dpad button{width:56px;height:56px;border-radius:12px;border:none;background:#254b2d;color:white;font-weight:900;box-shadow:0 3px 0 #173221;font-size:20px}
  #dpad .ghost{opacity:.7}
  /* Panels / Modals */
  .panel{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--panel);backdrop-filter:blur(3px);z-index:80}
  .panel.show{display:flex}
  .box{background:var(--card);border:1px solid #2f5b3f;border-radius:12px;padding:16px 20px;box-shadow:0 12px 36px rgba(0,0,0,.6);max-width:94vw;color:var(--ink)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  button.btn{background:var(--btn);border:none;border-radius:8px;padding:8px 12px;color:#fff;font-weight:700;cursor:pointer}
  button.btn:hover{background:var(--btn-h)}
  .danger{background:var(--danger)}
  .hp{width:240px;height:16px;background:#102016;border-radius:8px;overflow:hidden;border:1px solid #000}
  .fill{height:100%;background:#ff6b6b;width:100%;transition:width .18s linear}
  .label{font-weight:800;margin-bottom:4px}
  /* SimDex */
  #dexGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;max-height:60vh;overflow:auto}
  .dexCard{display:flex;gap:10px;align-items:center;background:#203425;border:2px solid #2f5b3f;border-radius:12px;padding:10px;cursor:pointer;position:relative;padding-right:12px}
  .dexCard img{width:64px;height:64px;object-fit:cover;border-radius:8px;background:#0b150e}
  .rarity-Common{border-color:rgba(120,180,255,0.15)}
  .rarity-Uncommon{border-color:#a0a7ad}
  .rarity-Rare{border-color:#a56cff;box-shadow:0 0 12px rgba(165,108,255,.12)}
  .rarity-Legendary{border-color:gold;animation:legendGlow 1.6s infinite}
  @keyframes legendGlow{0%{box-shadow:0 0 6px gold}50%{box-shadow:0 0 18px gold}100%{box-shadow:0 0 6px gold}}
  .rarity-Mythic{border-color:#7b56ff;animation:mythGlow 1.6s infinite}
  @keyframes mythGlow{0%{box-shadow:0 0 6px #7b56ff}50%{box-shadow:0 0 14px #45b6ff}100%{box-shadow:0 0 6px #7b56ff}}
  .rarity-Exotic{border:3px solid transparent;animation:exoticRainbow 2s linear infinite}
  @keyframes exoticRainbow{
    0%{border-color:#ff0000}14%{border-color:#ff7f00}28%{border-color:#ffff00}42%{border-color:#00ff00}
    56%{border-color:#0000ff}70%{border-color:#4b0082}84%{border-color:#8f00ff}100%{border-color:#ff0000}
  }
  /* Settings grid */
  #settingsGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  #settingsGrid label{display:flex;flex-direction:column;font-weight:700;font-size:14px;gap:6px}
  input[type="file"]{background:#122017;border:1px solid #24442d;border-radius:8px;padding:6px}
  .muted{opacity:.8}
  .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#233b29;border:1px solid #2e5a3b;border-radius:6px;padding:2px 6px}
  .note{font-size:12px;opacity:.8}
  /* Small screens */
  @media (max-width:860px){
    canvas#game{width:94vw;height:auto}
    #dpad{left:50%;transform:translateX(-50%);grid-template-columns:64px 64px;grid-template-rows:64px 64px 64px}
    #dpad button{width:64px;height:64px;border-radius:14px;font-size:22px}
    #hud{left:8px;right:8px;justify-content:center}
    #settingsGrid{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="wrap">
  <canvas id="game" width="640" height="512"></canvas>
</div>

<!-- HUD -->
<div id="hud" style="display:none">
  <button id="btnSettings" class="pill">Settings</button>
  <button id="btnDex" class="pill">SimDex</button>
  <button id="btnMusic" class="pill">Music: On</button>
  <button id="btnSignOut" class="pill secondary">Sign Out</button>
</div>

<!-- Dpad -->
<div id="dpad" style="display:none">
  <button id="padUp" class="ghost">▲</button>
  <button id="padLeft">◀</button>
  <button id="padRight">▶</button>
  <button id="padDown" class="ghost">▼</button>
</div>

<!-- MENU / SIGNIN -->
<div id="menu" class="panel show">
  <div class="box" style="text-align:center;max-width:480px">
    <h1 style="margin:6px 0 2px">Simitaur Adventure</h1>
    <p class="muted" style="margin:0 0 10px">Explore, catch, and battle Simitaurs. Upload your own sprites in <b>Settings</b>.</p>
    <div id="signin-area">
      <input id="playerName" placeholder="Player name" style="padding:10px;width:86%;margin:6px;border-radius:8px;border:1px solid #274f34;background:#0f1b13;color:#eafff0"><br>
      <input id="playerPass" placeholder="Password" type="password" style="padding:10px;width:86%;margin:6px;border-radius:8px;border:1px solid #274f34;background:#0f1b13;color:#eafff0"><br>
      <label style="display:flex;align-items:center;justify-content:center;margin-top:4px"><input id="rememberMe" type="checkbox" style="margin-right:8px"> Remember Me</label>
      <div class="row" style="justify-content:center;margin-top:12px">
        <button id="btnSignIn" class="btn">Sign In</button>
        <button id="btnGuest" class="btn">Play as Guest</button>
      </div>
    </div>
    <div id="menu-main" style="display:none;margin-top:10px" class="row">
      <button id="btnStart" class="btn" style="padding:10px 16px">Start Game</button>
      <button id="btnOpenSettings" class="btn">Settings</button>
      <button id="btnOpenDexPanel" class="btn">SimDex</button>
    </div>
    <p class="note">Controls: <span class="kbd">Arrow Keys / WASD</span> or on-screen D-Pad • Click tiles by stepping onto them</p>
  </div>
</div>

<!-- Settings -->
<div id="settings" class="panel">
  <div class="box" style="min-width:320px;max-width:780px">
    <h2 style="margin-top:0">Settings & Uploads</h2>
    <div id="settingsGrid">
      <label>Player Sprite<input id="filePlayer" type="file" accept="image/*"></label>
      <label>Charcoal (NPC) Sprite<input id="fileNPC" type="file" accept="image/*"></label>
      <label>SimNet (catch image)<input id="fileNet" type="file" accept="image/*"></label>
      <label>Sim Sprite Slot 1<input class="fileSim" data-id="0" type="file" accept="image/*"></label>
      <label>Sim Sprite Slot 2<input class="fileSim" data-id="1" type="file" accept="image/*"></label>
      <label>Sim Sprite Slot 3<input class="fileSim" data-id="2" type="file" accept="image/*"></label>
      <label>Sim Sprite Slot 4<input class="fileSim" data-id="3" type="file" accept="image/*"></label>
      <label>Sim Sprite Slot 5<input class="fileSim" data-id="4" type="file" accept="image/*"></label>
      <label>Sim Sprite Slot 6<input class="fileSim" data-id="5" type="file" accept="image/*"></label>
    </div>
    <div class="row" style="justify-content:space-between;margin-top:12px">
      <div class="note">Tip: Upload square-ish images for the best look. Your uploads stay in this session (and can be saved if “Remember Me” is checked).</div>
      <div><button id="btnCloseSettings" class="btn">Close</button></div>
    </div>
  </div>
</div>

<!-- SimDex -->
<div id="dex" class="panel">
  <div class="box" style="max-width:980px">
    <h2 style="margin-top:0">Your SimDex</h2>
    <div id="dexGrid"></div>
    <div style="text-align:center;margin-top:10px"><button id="btnCloseDex" class="btn">Close</button></div>
  </div>
</div>

<!-- Encounter panel -->
<div id="encounterPanel" class="panel">
  <div class="box">
    <h2 id="encounterTitle" style="margin-top:0">Encounter</h2>
    <div class="row" style="justify-content:center">
      <button id="btnTalk" class="btn">Talk</button>
      <button id="btnFight" class="btn">Battle</button>
      <button id="btnCatchSim" class="btn">Catch (SimNet)</button>
      <button id="btnRun" class="btn danger">Run</button>
    </div>
  </div>
</div>

<!-- Choose Sim for battle -->
<div id="chooseSimPanel" class="panel">
  <div class="box" style="max-width:620px">
    <h2 style="margin-top:0">Choose a Sim to battle</h2>
    <div id="chooseSimList" class="row" style="justify-content:center"></div>
    <div style="text-align:center;margin-top:8px"><button id="btnCancelChoose" class="btn">Cancel</button></div>
  </div>
</div>

<!-- Battle panel -->
<div id="battlePanel" class="panel">
  <div class="box">
    <h2 id="battleTitle" style="margin-top:0">Battle</h2>
    <div class="row" style="justify-content:center;gap:26px">
      <div style="text-align:center">
        <div id="playerLabel" class="label">You</div>
        <div class="hp"><div id="hpYou" class="fill"></div></div>
      </div>
      <div style="text-align:center">
        <div id="enemyLabel" class="label">Enemy</div>
        <div <div style="text-align:center">
  <div id="enemyLabel" class="label">Enemy</div>
  <div class="hp"><div id="hpEnemy" class="fill"></div></div>
</div>
</div> <!-- end row -->

<div id="battleButtons" class="row" style="justify-content:center;margin-top:10px"></div>
<div style="text-align:center;margin-top:12px">
  <button id="btnRunBattle" class="btn danger">Run</button>
</div>
</div>
</div>
